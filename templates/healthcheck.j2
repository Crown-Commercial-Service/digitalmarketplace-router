server {
    listen 80 default_server;

    # unset HSTS header
    add_header Strict-Transport-Security "";

    location /_status {
        access_log off;
        return 200 'nginx healthcheck status ok\n';
    }

    # pass these requests through to the nginx-prometheus-exporter
    location /_metrics {
        proxy_pass http://127.0.0.1:9113/metrics;
    }
}

# enable "stub status" endpoint for the nginx-prometheus-exporter to poll
server {
    listen 9112;

    allow 127.0.0.1;
    deny all;

    location /stub-status {
        stub_status;
        access_log off;
    }
}
